<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="BaseLog - 野球の記録と交流をひとつに。練習記録、動画共有、健康管理をサポートする野球専門SNS">
  
  <title>BaseLog - 野球の記録と交流をひとつに</title>
  
  <!-- Theme Color -->
  <meta name="theme-color" content="#2e7d46">
  
  <!-- iOS PWA設定 -->
  <!-- Androidでフルスクリーンモード有効化 -->
  <meta name="mobile-web-app-capable" content="yes">
  <!-- iOSでフルスクリーンモード有効化（ホーム画面追加時） -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- iOSステータスバーのスタイル（default/black/black-translucent） -->
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- iOSホーム画面でのアプリ名 -->
  <meta name="apple-mobile-web-app-title" content="BaseLog">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icon-16x16.png">
  
  <!-- iOS Safari PWAアイコン（重要: PNGである必要があります） -->
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-180x180.png">
  
  <!-- PWA Manifest（キャッシュバスティング付き） -->
  <link rel="manifest" href="/manifest.json?v=2024.1">
  
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="BaseLog">
  <meta property="og:description" content="野球の記録と交流をひとつに">
  <meta property="og:image" content="/icon.svg">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="BaseLog">
  <meta name="twitter:description" content="野球の記録と交流をひとつに">
  <meta name="twitter:image" content="/icon.svg">
  
  <!-- Safari互換性のためのpolyfill -->
  <script>
    // Safari用のObject.assignポリフィル
    if (typeof Object.assign !== 'function') {
      Object.defineProperty(Object, 'assign', {
        value: function assign(target) {
          'use strict';
          if (target === null || target === undefined) {
            throw new TypeError('Cannot convert undefined or null to object');
          }
          var to = Object(target);
          for (var index = 1; index < arguments.length; index++) {
            var nextSource = arguments[index];
            if (nextSource !== null && nextSource !== undefined) {
              for (var nextKey in nextSource) {
                if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                  to[nextKey] = nextSource[nextKey];
                }
              }
            }
          }
          return to;
        },
        writable: true,
        configurable: true
      });
    }
    
    // Safari用のPromise.finallyポリフィル
    if (!Promise.prototype.finally) {
      Promise.prototype.finally = function(callback) {
        var promise = this;
        var constructor = promise.constructor;
        return promise.then(
          function(value) {
            return constructor.resolve(callback()).then(function() {
              return value;
            });
          },
          function(reason) {
            return constructor.resolve(callback()).then(function() {
              throw reason;
            });
          }
        );
      };
    }
    
    // Safari用のArray.prototype.includesポリフィル
    if (!Array.prototype.includes) {
      Array.prototype.includes = function(searchElement, fromIndex) {
        var O = Object(this);
        var len = parseInt(O.length) || 0;
        if (len === 0) return false;
        var n = parseInt(fromIndex) || 0;
        var k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);
        while (k < len) {
          if (searchElement === O[k]) return true;
          k++;
        }
        return false;
      };
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <!-- メインアプリケーション -->
  <script type="module" src="/src/main.jsx"></script>
  
  <!-- Service Worker登録（本番環境のみ、DOM読み込み後に実行） -->
  <script>
    // DOM読み込み完了後にService Workerを登録
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', registerServiceWorker);
    } else {
      registerServiceWorker();
    }
    
    function registerServiceWorker() {
      // Vercelの本番環境でのみService Workerを有効化
      const isProduction = window.location.hostname.endsWith('.vercel.app') && 
                          !window.location.hostname.includes('-git-') && // Gitブランチのプレビュー
                          !window.location.hostname.includes('localhost') &&
                          !window.location.hostname.includes('127.0.0.1');
      
      // Safari対応: Service Worker対応チェック
      if (isProduction && 'serviceWorker' in navigator) {
        // 少し遅延させてメインアプリの読み込みを優先
        setTimeout(() => {
          console.log('[SW] 本番環境検出。Service Workerを登録します。');
          const script = document.createElement('script');
          script.src = '/register-sw.js?v=' + Date.now(); // キャッシュバスティング
          document.body.appendChild(script);
        }, 1000);
      } else if (!isProduction) {
        console.log('[SW] 開発/プレビュー環境のため、Service Workerは無効化されています');
      } else if (!('serviceWorker' in navigator)) {
        console.log('[SW] このブラウザはService Workerをサポートしていません');
      }
    }
  </script>
</body>
</html>